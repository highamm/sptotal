<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fits a Separate Spatial Linear Model for Each Stratum — stratafit • sptotal</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fits a Separate Spatial Linear Model for Each Stratum — stratafit"><meta property="og:description" content="Estimates regression coefficients and spatial autocorrelation
parameters, given spatial coordinates, a model formula, and a
stratification variable. Arguments are the same here as they are
for slmfit(), with an extra argument for
stratacol, the name of the stratification column. Note that
stratum can either by incorporated as a covariate in
slmfit(), in which case the errors have the same
spatial covariance, or, models with differing spatial covariances
for the errors can be fit to each level of stratum, as is done here
in stratafit()."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sptotal</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/sptotal-vignette.html">Inference for Totals and Weighted Sums from Finite Spatial Populations</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/highamm/sptotal/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fits a Separate Spatial Linear Model for Each Stratum</h1>
    <small class="dont-index">Source: <a href="https://github.com/highamm/sptotal/blob/HEAD/R/stratafit.R" class="external-link"><code>R/stratafit.R</code></a></small>
    <div class="hidden name"><code>stratafit.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Estimates regression coefficients and spatial autocorrelation
parameters, given spatial coordinates, a model formula, and a
stratification variable. Arguments are the same here as they are
for <code><a href="slmfit.html">slmfit</a>()</code>, with an extra argument for
<code>stratacol</code>, the name of the stratification column. Note that
stratum can either by incorporated as a covariate in
<code><a href="slmfit.html">slmfit</a>()</code>, in which case the errors have the same
spatial covariance, or, models with differing spatial covariances
for the errors can be fit to each level of stratum, as is done here
in <code>stratafit()</code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">stratafit</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">xcoordcol</span>,</span>
<span>  <span class="va">ycoordcol</span>,</span>
<span>  stratacol <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  areacol <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  CorModel <span class="op">=</span> <span class="st">"Exponential"</span>,</span>
<span>  estmethod <span class="op">=</span> <span class="st">"REML"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>formula</dt>
<dd><p>is an <code>R</code> linear model formula specifying the
response variable as well as covariates for predicting the response on the unsampled sites.</p></dd>


<dt>data</dt>
<dd><p>is the data set with the response column, the covariates to
be used for the block kriging, and the spatial coordinates for all of the sites.</p></dd>


<dt>xcoordcol</dt>
<dd><p>is the name of the column in the data frame with x coordinates or longitudinal coordinates</p></dd>


<dt>ycoordcol</dt>
<dd><p>is the name of the column in the data frame with y coordinates or latitudinal coordinates</p></dd>


<dt>stratacol</dt>
<dd><p>is the name of the stratification column</p></dd>


<dt>areacol</dt>
<dd><p>is the name of the column with the areas of the sites. By default, we assume that all sites have equal area, in which
case a vector of 1's is used as the areas.</p></dd>


<dt>CorModel</dt>
<dd><p>is the covariance structure. By default, <code>CorModel</code> is
Exponential but other options include the Spherical and Gaussian.</p></dd>


<dt>estmethod</dt>
<dd><p>is either the default <code>"REML"</code> for restricted
maximum likelihood to estimate the covariance parameters and
regression coefficients or <code>"ML"</code> to estimate the covariance
parameters and regression coefficients.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>a list of class <code>slmfit</code> with</p><ul><li><p>the spatial covariance estimates</p></li>
<li><p>the regression coefficient estimates</p></li>
<li><p>the covariance matrix of the fixed effects</p></li>
<li><p>minus two times the log-likelihood of the model</p></li>
<li><p>the names of the predictors</p></li>
<li><p>the sample size</p></li>
<li><p>the name of the covariance model used</p></li>
<li><p>a vector of residuals</p></li>
<li><p>the design matrix</p></li>
<li><p>a vector of the sampled densities</p></li>
<li><p>a list containing</p><ol><li><p>formula, the model formula</p></li>
<li><p>data, the data set input as the <code>data</code> argument</p></li>
<li><p>xcoordcol, the name of the x-coordinate column</p></li>
<li><p>ycoordcol, the name of the y-coordinate column</p></li>
<li><p>estmethod, either REML or ML</p></li>
<li><p>CorModel, the correlation model used</p></li>
<li><p>estimated covariance matrix of all sites</p></li>
<li><p>Inverted covariance matrix on the sampled sites</p></li>
<li><p>the vector of areas.</p></li>
</ol></li>
</ul></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">exampledataset</span><span class="op">)</span> <span class="co">## load a toy data set</span></span></span>
<span class="r-in"><span><span class="va">exampledataset</span><span class="op">$</span><span class="va">strata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="fl">19</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="fl">21</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">strataobj</span> <span class="op">&lt;-</span> <span class="fu">stratafit</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">counts</span> <span class="op">~</span> <span class="va">pred1</span> <span class="op">+</span> <span class="va">pred2</span>,</span></span>
<span class="r-in"><span> data <span class="op">=</span> <span class="va">exampledataset</span>, stratacol <span class="op">=</span> <span class="st">"strata"</span>,</span></span>
<span class="r-in"><span>xcoordcol <span class="op">=</span> <span class="st">'xcoords'</span>, ycoordcol <span class="op">=</span> <span class="st">'ycoords'</span>, areacol <span class="op">=</span> <span class="st">'areavar'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">strataobj</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $A</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> counts ~ pred1 + pred2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min      1Q  Median      3Q     Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -7.7826 -2.1499  0.0488  1.5492  9.8233 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value Pr(&gt;|t|)  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  22.2882    35.0930   0.635   0.5364  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pred1        -6.5176     3.6384  -1.791   0.0965 .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pred2         0.5545     1.7976   0.308   0.7626  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Covariance Parameters:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Exponential Model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Nugget                 20.0915</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Partial Sill         1227.2769</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Range                8575.6681</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Generalized R-squared: 0.1998733 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $B</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> counts ~ pred1 + pred2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min     1Q Median     3Q    Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -9.262 -4.974  1.516  3.355 14.635 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   19.146      2.994   6.395    1e-05 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pred1          1.430      5.255   0.272    0.789    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pred2         -1.603      1.274  -1.259    0.226    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Covariance Parameters:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Exponential Model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Nugget            4.188789e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Partial Sill      4.205452e+01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Range             4.954309e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Generalized R-squared: 0.09916644 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Matt Higham, Jay Ver Hoef, Bryce Frank, Michael Dumelle.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

